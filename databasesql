CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT 1
);

-- Dietary preferences table
CREATE TABLE IF NOT EXISTS dietary_preferences (
    preference_id INTEGER PRIMARY KEY AUTOINCREMENT,
    preference_name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- User dietary preferences junction table
CREATE TABLE IF NOT EXISTS user_dietary_preferences (
    user_id INTEGER,
    preference_id INTEGER,
    PRIMARY KEY (user_id, preference_id),
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (preference_id) REFERENCES dietary_preferences(preference_id) ON DELETE CASCADE
);

-- Meal categories table
CREATE TABLE IF NOT EXISTS meal_categories (
    category_id INTEGER PRIMARY KEY AUTOINCREMENT,
    category_name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Meals table to store meal information
CREATE TABLE IF NOT EXISTS meals (
    meal_id INTEGER PRIMARY KEY AUTOINCREMENT,
    meal_name VARCHAR(100) NOT NULL,
    category_id INTEGER NOT NULL,
    prep_time INTEGER NOT NULL DEFAULT 0,
    calories INTEGER DEFAULT 0,
    protein DECIMAL(5,2) DEFAULT 0,
    carbs DECIMAL(5,2) DEFAULT 0,
    fat DECIMAL(5,2) DEFAULT 0,
    fiber DECIMAL(5,2) DEFAULT 0,
    sugar DECIMAL(5,2) DEFAULT 0,
    sodium DECIMAL(5,2) DEFAULT 0,
    description TEXT,
    instructions TEXT,
    image_url VARCHAR(255),
    created_by INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT 1,
    FOREIGN KEY (category_id) REFERENCES meal_categories(category_id),
    FOREIGN KEY (created_by) REFERENCES users(user_id),
    UNIQUE(meal_name, category_id)
);

-- Ingredients table
CREATE TABLE IF NOT EXISTS ingredients (
    ingredient_id INTEGER PRIMARY KEY AUTOINCREMENT,
    ingredient_name VARCHAR(100) UNIQUE NOT NULL,
    category VARCHAR(50), -- e.g., 'vegetable', 'protein', 'grain', 'dairy'
    unit VARCHAR(20) DEFAULT 'pieces', -- e.g., 'cups', 'grams', 'pieces'
    calories_per_unit DECIMAL(8,2) DEFAULT 0,
    protein_per_unit DECIMAL(8,2) DEFAULT 0,
    carbs_per_unit DECIMAL(8,2) DEFAULT 0,
    fat_per_unit DECIMAL(8,2) DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
